/*

 | _ __ ___ (_) ___ _ __ ___
 | '_ ` _ \| |/ __| '__/ _ \
 | | | | | | | (__| | | (_) |
 |_| |_| |_|_|\___|_|  \___/
 |               version 0.0.1

 Pico/Nano like editor for jquery

 http://micro.jcubic.pl

 Licensed under GNU GPL Version 3 license
 Copyright (c) 2013 Jakub Jankiewicz <http://jcubic.pl>

 Date: Sun, 28 Jul 2013 09:00:07 +0000
*/
(function(b){function i(a,c){this._root=b(a);this._letter=this.calculate_letter_size();this._root.addClass("micro");this._root.css({width:c.width,height:c.height});this._title=b("<div/>").addClass("title").appendTo(this._root);this.set_file_name("");b("<div>&nbsp;</div>").addClass("spacer").appendTo(this._root);this._table=b("<div/>").addClass("matrix");this.refresh();this._matrix=[];for(var d=0;d<this._rows;++d){var e=b("<div/>").addClass("line").appendTo(this._table);this._matrix[d]=[];for(var f=
0;f<this._cols;++f){var g=b("<span>&nbsp;</span>").appendTo(e);this._matrix[d][f]=g}}this._cursor={x:0,y:0};this._table.appendTo(this._root);this._footer=b("<div/>").addClass("footer").appendTo(this._root);this._message=b("<div/>").addClass("message").append("<span/>").appendTo(this._root).find("span")}i.prototype={refresh:function(){this._rows=Math.floor(this._root.height()/this._letter.height)-4;this._cols=Math.floor(this._root.width()/this._letter.width);return this},_view:function(a){if(this._lines){var c=
this._lines.slice(a,a+this._rows),d=this._cursor.y-a;if(c[d].length>this._cols&&this._cursor.x>this._cols){for(a=0;a<d;++a);for(a=d+1;a<c.length;++a);}else{var e=this;b.each(c,function(f,g){for(var j=g.length>e._cols?e._cols:g.length,h=0;h<j;++h)e._matrix[f][h].html(g[h].replace(" ","&nbsp;"))})}}return this},version:function(){return"{{VER}}"},set_file_name:function(a){for(var c="  jQuery Micro "+this.version(),d="",e=30-c.length;e--;)d+=" ";c+=d+b.micro.strings.file+": "+a;this._title.html(c.replace(/ /g,
"&nbsp;"))},message:function(a){this._message.text(a)},open:function(a){var c=this;b.get(a,function(d){c.set_file_name(a);c._lines=d.split("\n");c._view(0)});return this},calculate_letter_size:function(){var a=b('<div class="micro"><div><span>&nbsp;</span></div></div>').appendTo("body"),c=a.find("span").width(),d=a.find("div").height();a.remove();return{width:c,height:d}}};b.micro={defaults:{width:"100%",height:"400px"},strings:{file:"File"},init:i,fn:i.prototype};b.fn.micro=function(a){if(typeof a===
"string"){var c=Array.prototype.slice.call(arguments);c.shift();return b.each(this,function(){var e=b(this).data("micro");b.micro.fn[a].apply(e,c)})}else{var d=b.extend({},b.micro.defaults,a);b.each(this,function(){b(this).data("micro",new b.micro.init(this,d))})}}})(jQuery);
