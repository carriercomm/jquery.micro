/*


 jQuery Micro version 0.1-alpha

 Pico/Nano like editor for jquery

 http://micro.jcubic.pl

 Licensed under GNU GPL Version 3 license
 Copyright (c) 2013 Jakub Jankiewicz <http://jcubic.pl>

 Contain:
 sprintf.js: Copyright (c) 2007-2013 Alexandru Marasteanu <hello at alexei dot ro>
 licensed under 3 clause BSD license

 Date: Sat, 03 Aug 2013 13:34:06 +0000
*/
(function(g){function l(b){return Object.prototype.toString.call(b).slice(8,-1).toLowerCase()}var a=function(){a.cache.hasOwnProperty(arguments[0])||(a.cache[arguments[0]]=a.parse(arguments[0]));return a.format.call(null,a.cache[arguments[0]],arguments)};a.format=function(b,d){var f=1,k=b.length,c="",e=[],h,j,i,m;for(h=0;h<k;h++){c=l(b[h]);if(c==="string")e.push(b[h]);else if(c==="array"){i=b[h];if(i[2]){c=d[f];for(j=0;j<i[2].length;j++){if(!c.hasOwnProperty(i[2][j]))throw a('[sprintf] property "%s" does not exist',
i[2][j]);c=c[i[2][j]]}}else c=i[1]?d[i[1]]:d[f++];if(/[^s]/.test(i[8])&&l(c)!="number")throw a("[sprintf] expecting number but found %s",l(c));switch(i[8]){case "b":c=c.toString(2);break;case "c":c=String.fromCharCode(c);break;case "d":c=parseInt(c,10);break;case "e":c=i[7]?c.toExponential(i[7]):c.toExponential();break;case "f":c=i[7]?parseFloat(c).toFixed(i[7]):parseFloat(c);break;case "o":c=c.toString(8);break;case "s":c=(c=String(c))&&i[7]?c.substring(0,i[7]):c;break;case "u":c>>>=0;break;case "x":c=
c.toString(16);break;case "X":c=c.toString(16).toUpperCase()}c=/[def]/.test(i[8])&&i[3]&&c>=0?"+"+c:c;j=i[4]?i[4]=="0"?"0":i[4].charAt(1):" ";m=i[6]-String(c).length;if(i[6]){for(var n=[];m>0;n[--m]=j);j=n.join("")}else j="";e.push(i[5]?c+j:j+c)}}return e.join("")};a.cache={};a.parse=function(b){for(var d=[],f=[],k=0;b;){if((d=/^[^\x25]+/.exec(b))!==null)f.push(d[0]);else if((d=/^\x25{2}/.exec(b))!==null)f.push("%");else if((d=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b))!==
null){if(d[2]){k|=1;var c=[],e=d[2],h=[];if((h=/^([a-z_][a-z_\d]*)/i.exec(e))!==null)for(c.push(h[1]);(e=e.substring(h[0].length))!=="";)if((h=/^\.([a-z_][a-z_\d]*)/i.exec(e))!==null)c.push(h[1]);else if((h=/^\[(\d+)\]/.exec(e))!==null)c.push(h[1]);else throw"[sprintf] huh?";else throw"[sprintf] huh?";d[2]=c}else k|=2;if(k===3)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";f.push(d)}else throw"[sprintf] huh?";b=b.substring(d[0].length)}return f};g.sprintf=a;g.vsprintf=
function(b,d,f){f=d.slice(0);f.splice(0,0,b);return a.apply(null,f)}})(typeof exports!="undefined"?exports:window);
(function(g){function l(a,b){this._root=g(a);this._letter=this._calculate_letter_size();this._root.addClass("micro");this._root.css({width:b.width,height:b.height});this._settings=b;this._title=g("<div/>").addClass("title").appendTo(this._root);this._set_file_name("");g("<div>&nbsp;</div>").addClass("spacer").appendTo(this._root);this._table=g("<div/>").addClass("matrix");this.refresh();this._matrix=[];for(var d=0;d<this._rows;++d){var f=g("<div/>").addClass("line").appendTo(this._table);this._matrix[d]=
[];for(var k=0;k<this._cols;++k){var c=g("<span>&nbsp;</span>").appendTo(f);this._matrix[d][k]=c}}this._pointer={x:0,y:0};this._table.appendTo(this._root);this._footer=g("<div/>").addClass("footer").appendTo(this._root);this._message=g("<div/>").addClass("message").append("<span/>").appendTo(this._root).find("span");this._lines=[""];this._page=this._offset=0;var e=this;this._focus=b.enabled;g(document).bind("keydown.micro",function(h){console.log(e._pointer.y+" / "+e._lines.length);if(e._focus){h.preventDefault();
if(h.which===37)e._pointer.x>0&&e._set_pointer(e._pointer.x-1,e._pointer.y);else if(h.which===38)e._pointer.y>0&&e._set_pointer(e._pointer.x,e._pointer.y-1);else if(h.which===39)e._pointer.x<e._lines[e._pointer.y].length&&e._set_pointer(e._pointer.x+1,e._pointer.y);else if(h.which===40)e._pointer.y<e._lines.length-1&&e._set_pointer(e._pointer.x,e._pointer.y+1);else if(h.which===35)e._set_pointer(e._lines[e._pointer.y].length,e._pointer.y);else h.which===36&&e._set_pointer(0,e._pointer.y)}}).bind("click.micro",
function(h){h=g(h.target).parents(".micro");h.length?h.data("micro").focus(true):e.focus(false)})}l.prototype={focus:function(a){if(a===true||typeof a==="undefined"){this._focus=true;this._table.find(".cursor").removeClass("inactive").css({width:"",height:""})}else{this._focus=false;this._table.find(".cursor").addClass("inactive").css({width:this._letter.width-2,height:this._letter.height-2})}},destroy:function(){this._root.removeData("micro").removeClass("micro");this._table.remove();this._footer.remove();
this._message.remove();g(document).unbind(".micro")},refresh:function(){this._rows=Math.floor(this._root.height()/this._letter.height)-4;this._cols=Math.floor(this._root.width()/this._letter.width);return this},text:function(){return this._lines.join("\n")},page:function(){return Math.floor((this._offset+this._settings.verticalMoveOffset)/this._rows)},_set_pointer:function(a,b){if(b>=this._lines.length)throw"Out of band";this._table.find(".cursor").removeClass("cursor");var d=Math.floor(this._rows/
2),f=this._offset+this._rows-d;this.message("[ line "+(b+1)+"/"+this._lines.length+" ]");if(b-this._offset>=this._rows){d=b-f;if(this._offset!==f){this._pointer.x=a;this._pointer.y=b;this._view(f)}}else if(b-this._offset<0){f=this._offset-this._rows+d;this._pointer.x=a;this._pointer.y=b;this._view(f);d=b-f}else d=b-f+d+1;if(a>=this._cols-1)if(a>this._lines[b].length)this._set_pointer(this._lines[b].length,b);else{this._pointer.x=a;this._pointer.y=b;this._draw_pointer_line()}else{this._pointer.x>=
this._cols-1&&this._draw_line(this._pointer.y-this._offset,this._lines[this._pointer.y]);a>this._lines[b].length?this._matrix[d][this._lines[b].length].addClass("cursor"):this._matrix[d][a].addClass("cursor")}this._pointer.x=a;this._pointer.y=b},_encode:function(a){return a.replace(" ","&nbsp;").replace("\t","&nbsp;&nbsp;&nbsp;&nbsp;")},_string_length:function(a){var b=a.match(/(\t)/g);return b?a.length+b.length*3:a.length},_draw_line:function(a,b){var d=b.length>this._cols?this._cols:b.length,f;
for(f=0;f<d;++f)this._matrix[a][f].html(this._encode(b[f]));if(this._string_length(b)>this._cols)this._matrix[a][this._cols-1].html("$");else for(f=b.length;f<this._cols;++f)this._matrix[a][f].html("&nbsp")},_draw_pointer_line:function(){var a=this._pointer.y-this._offset,b=this._lines[a];if(this._pointer.x>=this._cols-1)if(this._pointer.x>b.length)throw"Out of bound in _draw_pointer_line";else{var d=(this._cols-this._settings.horizontalMoveOffset-1)*Math.floor(this._pointer.x/(this._cols-1));this._draw_line(a,
"$"+b.substring(d,d+this._cols));this._matrix[a][this._pointer.x%(this._cols-1)+this._settings.horizontalMoveOffset+1].addClass("cursor")}},_view:function(a){if(this._lines){this._offset=a;var b=this._lines.slice(a,a+this._rows),d=this._pointer.y-a;if(b[d].length>this._cols&&this._pointer.x>this._cols){for(a=0;a<d;++a)this._draw_line(a,b[a]);for(a=d+1;a<b.length;++a)this._draw_line(a,b[a])}else g.each(b,this._draw_line.bind(this));if(b.length<this._rows)for(a=b.length;a<this._rows;++a)this._draw_line(a,
"")}return this},version:function(){return"0.1-alpha"},_set_file_name:function(a){for(var b="  jQuery Micro "+this.version(),d="",f=30-b.length;f--;)d+=" ";b+=d+g.micro.strings.file+": "+a;this._title.html(b.replace(/ /g,"&nbsp;"))},message:function(a){this._message.text(a)},open:function(a){var b=this;g.get(a,function(d){b._set_file_name(a);b._lines=d.split("\n");b._view(0);b._set_pointer(0,0)});return this},_calculate_letter_size:function(){var a=g('<div class="micro"><div><span>&nbsp;</span></div></div>').appendTo("body"),
b=a.find("span").width(),d=a.find("div").height();a.remove();return{width:b,height:d}}};g.micro={defaults:{enabled:true,width:"100%",height:"400px",verticalMoveOffset:9,horizontalMoveOffset:6},strings:{file:"File"},init:l,fn:l.prototype};g.fn.micro=function(a){if(typeof a==="string"){var b=Array.prototype.slice.call(arguments);b.shift();return a[0]!=="_"&&typeof g.micro.fn[a]==="function"?g.each(this,function(){var f=g(this).data("micro");g.micro.fn[a].apply(f,b)}):this}else{var d=g.extend({},g.micro.defaults,
a);g.each(this,function(){g(this).data("micro",new g.micro.init(this,d))})}}})(jQuery);
